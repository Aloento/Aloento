<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><title>Category: WebCodecs - Aloento</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#f0f0f0"><meta name="application-name" content="Aloento"><meta name="msapplication-TileImage" content="/img/Aloento.png"><meta name="msapplication-TileColor" content="#f0f0f0"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Aloento"><meta name="apple-mobile-web-app-status-bar-style" content="default"><link rel="apple-touch-icon" sizes="72x72" href="/img/Aloento.png"><link rel="apple-touch-icon" sizes="96x96" href="/img/Aloento.png"><link rel="apple-touch-icon" sizes="128x128" href="/img/Aloento.png"><link rel="apple-touch-icon" sizes="256x256" href="/img/Aloento.png"><meta name="description" content="Aloento"><meta property="og:type" content="blog"><meta property="og:title" content="Aloento"><meta property="og:url" content="https://aloen.to/"><meta property="og:site_name" content="Aloento"><meta property="og:description" content="Aloento"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://aloen.to/img/og_image.png"><meta property="article:author" content="Aloento"><meta property="article:tag" content="Aloento"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://Aloen.to"},"headline":"Aloento","image":["https://aloen.to/img/og_image.png"],"author":{"@type":"Person","name":"Aloento"},"publisher":{"@type":"Organization","name":"Aloento","logo":{"@type":"ImageObject","url":"https://aloen.to/"}},"description":"Aloento"}</script><link rel="icon" href="/img/Aloento.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://unpkg.com/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><link rel="stylesheet" href="https://unpkg.com/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://unpkg.com/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><link rel="stylesheet" href="https://unpkg.com/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://unpkg.com/pace-js@1.2.4/pace.min.js"></script><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }
          Array
              .from(document.querySelectorAll('.tab-content'))
              .forEach($tab => {
                  $tab.classList.add('is-hidden');
              });
          Array
              .from(document.querySelectorAll('.tabs li'))
              .forEach($tab => {
                  $tab.classList.remove('is-active');
              });
          const $activeTab = document.querySelector(location.hash);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.1.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Aloento</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" target="_blank" rel="noopener" href="https://Q-Audio.org/Aloento">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Q-Audio" href="https://Q-Audio.org"><i class="fas fa-compact-disc"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="MusiLand" href="https://Musi.Land/"><i class="fab fa-dashcube"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="GitHub" href="https://github.com/Aloento"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/categories">Categories</a></li><li><a href="/categories/Program/">Program</a></li><li><a href="/categories/Program/FrontEnd/">FrontEnd</a></li><li class="is-active"><a href="#" aria-current="page">WebCodecs</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-04-05T03:58:53.000Z" title="4/5/2022, 3:58:53 AM">2022-04-05</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-04-16T16:11:18.835Z" title="4/16/2022, 4:11:18 PM">2022-04-17</time></span><span class="level-item"><a class="link-muted" href="/categories/Program/">Program</a><span> / </span><a class="link-muted" href="/categories/Program/FrontEnd/">FrontEnd</a><span> / </span><a class="link-muted" href="/categories/Program/FrontEnd/WebCodecs/">WebCodecs</a></span><span class="level-item">18 minutes read (About 2757 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Program/FrontEnd/WebCodecs/%E8%AE%BA%E4%BD%BF%E7%94%A8WebCodecs%E5%AF%B9%E8%A7%86%E9%A2%91%E8%BF%9B%E8%A1%8C%E5%A4%84%E7%90%86/">论使用WebCodecs对视频进行处理</a></h1><div class="content"><p><a target="_blank" rel="noopener" href="https://web.dev/webcodecs/">原文</a> 更新于 2022-02-10，由 Aloento 翻译，具体以原文为准</p>
<hr>
<p>现代的 Web 技术为视频提供了丰富的处理能力，例如 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/API/MediaStream_Recording_API">Media Stream API</a>、<a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/API/MediaStream_Recording_API">Media Recording API</a>、<a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/API/Media_Source_Extensions_API">Media Source API</a>, 和 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/API/WebRTC_API">WebRTC API</a> 等，它们提供了丰富的工具以便 录制、传输、回放视频流。<br>这些 API 虽然封装了很多高级功能以便方便的完成既定任务，但它们并不能让你处理视频流的内部细节，如 按帧处理 和 处理未 Muxed 的视频或音频块等。<br>为了实现以上目的，你不得不使用一些类似 <code>WebAssembly</code> 的方式来把浏览器本就自带的编解码器（通常它们都有硬件加速）又一次的引入，这属实是对资源的浪费。</p>
<p>而 <a target="_blank" rel="noopener" href="https://w3c.github.io/webcodecs/">WebCodecs API</a> 为程序员提供了使用浏览器自带编解码器的能力，来提高你的工作流效率，具体而言：</p>
<ul>
<li>音视频的编解码</li>
<li>视频原始帧</li>
<li>图像解码</li>
</ul>
<p><code>WebCodecs API</code> 对于需要完全控制媒体内容处理方式的场景是非常有用的，例如视频编辑、视频会议、视频流等。</p>
<h2 id="视频处理工作流"><a href="#视频处理工作流" class="headerlink" title="视频处理工作流"></a>视频处理工作流</h2><p>帧 是视频处理的基本单位，因此，在 <code>WebCodecs</code> 中，大多数类要么使用帧，要么产生帧。编码器将帧转为编码的 chunks（块），而解码器则做相反的事情。<br><code>VideoFrame</code> 有一个可以接受 <a target="_blank" rel="noopener" href="https://html.spec.whatwg.org/multipage/canvas.html#canvasimagesource"><code>CanvasImageSource</code></a> 的构造函数来于其他的 Web API 很好的配合。所以它可以被用于 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/drawImage"><code>drawImage()</code></a> 和 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/API/WebGLRenderingContext/texImage2D"><code>texImage2D()</code></a> 等函数中. 此外，它还可以从 canvases, bitmaps, video elements 和 其他 video frames 中创建。</p>
<p><code>WebCodecs API</code> 可以用 <a target="_blank" rel="noopener" href="https://w3c.github.io/mediacapture-transform/">Insertable Streams API</a>，让 <code>WebCodecs</code> 和 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/API/MediaStreamTrack">media stream tracks</a> 一起工作。</p>
<ul>
<li><code>MediaStreamTrackProcessor</code> 将媒体流分解为单个帧。</li>
<li><code>MediaStreamTrackGenerator</code> 从帧序列中创建媒体流。</li>
</ul>
<h2 id="WebCodecs-和-Web-Workers"><a href="#WebCodecs-和-Web-Workers" class="headerlink" title="WebCodecs 和 Web Workers"></a>WebCodecs 和 Web Workers</h2><p>按照设计，<code>WebCodecs API</code> 以异步方式在主线程之外完成所有繁重的工作。但是由于帧和 Chunk 的回调经常在一秒之类被调用多次，这可能导致主线程的混乱，导致网页 UI 的缓慢和卡顿，所以我们最好将处理工作放到 Worker 线程中。</p>
<p>而 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/API/ReadableStream">ReadableStream</a> 有一个简便的方法可以将来自媒体流的帧全部自动转移到 Worker 线程中，例如，从摄像头的来的流通过 <code>MediaStreamTrackProcessor</code> 获取到 <code>ReadableStream</code> 后，就可以在 Worker 线程中被 <code>VideoEncoder</code> 处理。</p>
<p>我们甚至可以通过 <a target="_blank" rel="noopener" href="https://developers.google.com/web/updates/2018/08/offscreen-canvas#unblock_main_thread"><code>HTMLCanvasElement.transferControlToOffscreen</code></a> 在主线程之外进行渲染。但如果所有的高级接口都不满足你的需求，<code>VideoFrame</code> 本身也是可以在不同的 Worker 中<a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/API/Transferable">转移</a>的。</p>
<h2 id="WebCodecs-的编解码"><a href="#WebCodecs-的编解码" class="headerlink" title="WebCodecs 的编解码"></a>WebCodecs 的编解码</h2><h3 id="Encoding-x2F-编码"><a href="#Encoding-x2F-编码" class="headerlink" title="Encoding &#x2F; 编码"></a>Encoding &#x2F; 编码</h3><figure>
  <img src="1.png", alt="从Canvas或ImageBitmap到网络或存储的路径", width="800", height="393" />
</figure>

<p>我们从 <code>VideoFrame</code> 开始，有三种方法来构建视频帧。</p>
<ul>
<li>从图片源，如 canvas, image bitmap, 或 video element.</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;canvas&quot;</span>);</span><br><span class="line"><span class="comment">// Draw something on the canvas...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> frameFromCanvas = <span class="keyword">new</span> <span class="title class_">VideoFrame</span>(canvas, &#123; <span class="attr">timestamp</span>: <span class="number">0</span> &#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>使用 <code>MediaStreamTrackProcessor</code> 从 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/API/MediaStreamTrack"><code>MediaStreamTrack</code></a> 中提取帧</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> stream = <span class="keyword">await</span> navigator.<span class="property">mediaDevices</span>.<span class="title function_">getUserMedia</span>(&#123;…&#125;);</span><br><span class="line"><span class="keyword">const</span> track = stream.<span class="title function_">getTracks</span>()[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> trackProcessor = <span class="keyword">new</span> <span class="title class_">MediaStreamTrackProcessor</span>(track);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reader = trackProcessor.<span class="property">readable</span>.<span class="title function_">getReader</span>();</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> reader.<span class="title function_">read</span>();</span><br><span class="line">  <span class="keyword">if</span> (result.<span class="property">done</span>) <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">const</span> frameFromCamera = result.<span class="property">value</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>从 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/API/BufferSource"><code>BufferSource</code></a> 中的原始二进制像素中创建帧</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pixelSize = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">const</span> init = &#123;</span><br><span class="line">  <span class="attr">timestamp</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">codedWidth</span>: <span class="number">320</span>,</span><br><span class="line">  <span class="attr">codedHeight</span>: <span class="number">200</span>,</span><br><span class="line">  <span class="attr">format</span>: <span class="string">&quot;RGBA&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> data = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(init.<span class="property">codedWidth</span> * init.<span class="property">codedHeight</span> * pixelSize);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> x = <span class="number">0</span>; x &lt; init.<span class="property">codedWidth</span>; x++) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> y = <span class="number">0</span>; y &lt; init.<span class="property">codedHeight</span>; y++) &#123;</span><br><span class="line">    <span class="keyword">const</span> offset = (y * init.<span class="property">codedWidth</span> + x) * pixelSize;</span><br><span class="line">    data[offset] = <span class="number">0x7f</span>; <span class="comment">// Red</span></span><br><span class="line">    data[offset + <span class="number">1</span>] = <span class="number">0xff</span>; <span class="comment">// Green</span></span><br><span class="line">    data[offset + <span class="number">2</span>] = <span class="number">0xd4</span>; <span class="comment">// Blue</span></span><br><span class="line">    data[offset + <span class="number">3</span>] = <span class="number">0x0ff</span>; <span class="comment">// Alpha</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> frame = <span class="keyword">new</span> <span class="title class_">VideoFrame</span>(data, init);</span><br></pre></td></tr></table></figure>

<p>无论它们来自哪里，帧都可以用 <code>VideoEncoder</code> 编码为 <code>EncodedVideoChunk</code>。<br>而 <code>VideoEncoder</code> 需要两个参数：</p>
<ul>
<li>两个函数，用来处理已编码数据块和产生的错误，传入后不可变。</li>
<li>编码器配置，用来配置输出的视频流参数，可以使用 <code>configure()</code> 进行修改。</li>
</ul>
<p>如果你指定的配置不被浏览器支持，<code>configure()</code> 方法将抛出 <code>NotSupportedError</code>。<br>所以我们建议你调用异步静态方法 <code>VideoEncoder.isConfigSupported()</code> 来预先检查你的配置是否被用户的浏览器支持。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> init = &#123;</span><br><span class="line">  <span class="attr">output</span>: handleChunk,</span><br><span class="line">  <span class="attr">error</span>: <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">message</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  <span class="attr">codec</span>: <span class="string">&quot;vp8&quot;</span>,</span><br><span class="line">  <span class="attr">width</span>: <span class="number">640</span>,</span><br><span class="line">  <span class="attr">height</span>: <span class="number">480</span>,</span><br><span class="line">  <span class="attr">bitrate</span>: <span class="number">2_000_000</span>, <span class="comment">// 2 Mbps</span></span><br><span class="line">  <span class="attr">framerate</span>: <span class="number">30</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; supported &#125; = <span class="keyword">await</span> <span class="title class_">VideoEncoder</span>.<span class="title function_">isConfigSupported</span>(config);</span><br><span class="line"><span class="keyword">if</span> (supported) &#123;</span><br><span class="line">  <span class="keyword">const</span> encoder = <span class="keyword">new</span> <span class="title class_">VideoEncoder</span>(init);</span><br><span class="line">  encoder.<span class="title function_">configure</span>(config);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// Try another config.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编码器设置好以后，你就可以通过 <code>encode()</code> 方法来传入帧了。<br><code>configure()</code> 和 <code>encode()</code> 都不需要等待实际工作结束，它们会立刻返回。<br>编码器允许多个帧同时排队等待编码，<code>encodeQueueSize</code> 表示队列中有多少帧还未处理。</p>
<p>如果你传入的参数或调用方法的顺序不正确，则方法可以立刻抛出错误，也可以通过你设置的 <code>error()</code> 回调函数报告错误。<br>如果编码成功，就会调用你设置的 <code>output()</code> 回调函数。<br>这里需要强调一点，如果你的帧不再使用，你应该调用 <code>close()</code> 来释放资源。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> frameCounter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> track = stream.<span class="title function_">getVideoTracks</span>()[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">const</span> trackProcessor = <span class="keyword">new</span> <span class="title class_">MediaStreamTrackProcessor</span>(track);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reader = trackProcessor.<span class="property">readable</span>.<span class="title function_">getReader</span>();</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> reader.<span class="title function_">read</span>();</span><br><span class="line">  <span class="keyword">if</span> (result.<span class="property">done</span>) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> frame = result.<span class="property">value</span>;</span><br><span class="line">  <span class="keyword">if</span> (encoder.<span class="property">encodeQueueSize</span> &gt; <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="comment">// Too many frames in flight, encoder is overwhelmed</span></span><br><span class="line">    <span class="comment">// let&#x27;s drop this frame.</span></span><br><span class="line">    frame.<span class="title function_">close</span>();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    frameCounter++;</span><br><span class="line">    <span class="keyword">const</span> keyframe = frameCounter % <span class="number">150</span> == <span class="number">0</span>;</span><br><span class="line">    encoder.<span class="title function_">encode</span>(frame, &#123; keyFrame &#125;);</span><br><span class="line">    frame.<span class="title function_">close</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后，我们编写一个处理从编码器中得到的 Chunks 的函数，来完成最终的编码。<br>一般来说，这个函数会把 Chunk 发往服务器，或者将 Chunk <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Multiplexing#Video_processing">Muxing</a> 到一个容器中来生成一个视频文件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleChunk</span>(<span class="params">chunk, metadata</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (metadata.<span class="property">decoderConfig</span>) &#123;</span><br><span class="line">    <span class="comment">// Decoder needs to be configured (or reconfigured) with new parameters</span></span><br><span class="line">    <span class="comment">// when metadata has a new decoderConfig.</span></span><br><span class="line">    <span class="comment">// Usually it happens in the beginning or when the encoder has a new</span></span><br><span class="line">    <span class="comment">// codec specific binary configuration. (VideoDecoderConfig.description).</span></span><br><span class="line">    <span class="title function_">fetch</span>(<span class="string">&quot;/upload_extra_data&quot;</span>, &#123;</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">      <span class="attr">headers</span>: &#123; <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/octet-stream&quot;</span> &#125;,</span><br><span class="line">      <span class="attr">body</span>: metadata.<span class="property">decoderConfig</span>.<span class="property">description</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// actual bytes of encoded data</span></span><br><span class="line">  <span class="keyword">const</span> chunkData = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(chunk.<span class="property">byteLength</span>);</span><br><span class="line">  chunk.<span class="title function_">copyTo</span>(chunkData);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">fetch</span>(<span class="string">`/upload_chunk?timestamp=<span class="subst">$&#123;chunk.timestamp&#125;</span>&amp;type=<span class="subst">$&#123;chunk.type&#125;</span>`</span>, &#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">    <span class="attr">headers</span>: &#123; <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/octet-stream&quot;</span> &#125;,</span><br><span class="line">    <span class="attr">body</span>: chunkData,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果你需要确保所有的编码请求都已经完成，你可以调用异步函数 <code>flush()</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> encoder.<span class="title function_">flush</span>();</span><br></pre></td></tr></table></figure>

<h3 id="Decoding-x2F-解码"><a href="#Decoding-x2F-解码" class="headerlink" title="Decoding &#x2F; 解码"></a>Decoding &#x2F; 解码</h3><figure>
  <img src="2.png", alt="从网络或存储到Canvas或ImageBitmap的路径", width="800", height="419" />
</figure>

<p>设置 <code>VideoDecoder</code> 的方法与设置 <code>VideoEncoder</code> 的类似：在创建解码器的是否传入两个参数，并调用 <code>configure()</code> 修改解码器参数。<br>解码器的参数会因编码器的不同而不同，比如一个 H.264 解码器可能需要一个 <code>AVCC</code> 格式的二进制 blob，除非流是以 <code>Annex B</code> 编码的。<br>(<code>encoderConfig.avc = &#123; format: &quot;annexb&quot; &#125;</code>)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> init = &#123;</span><br><span class="line">  <span class="attr">output</span>: handleFrame,</span><br><span class="line">  <span class="attr">error</span>: <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">message</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  <span class="attr">codec</span>: <span class="string">&quot;vp8&quot;</span>,</span><br><span class="line">  <span class="attr">codedWidth</span>: <span class="number">640</span>,</span><br><span class="line">  <span class="attr">codedHeight</span>: <span class="number">480</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; supported &#125; = <span class="keyword">await</span> <span class="title class_">VideoDecoder</span>.<span class="title function_">isConfigSupported</span>(config);</span><br><span class="line"><span class="keyword">if</span> (supported) &#123;</span><br><span class="line">  <span class="keyword">const</span> decoder = <span class="keyword">new</span> <span class="title class_">VideoDecoder</span>(init);</span><br><span class="line">  decoder.<span class="title function_">configure</span>(config);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// Try another config.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在准备好解码器后，你需要给它一个 <code>EncodedVideoChunk</code>。要创建 Chunk，你需要：</p>
<ul>
<li>一个编码视频数据的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/API/BufferSource"><code>BufferSource</code></a></li>
<li>Chunk 的开始时间戳，单位是微秒（Chunk 中第一个编码帧的媒体时间）</li>
<li>Chunk 的类型：<ul>
<li><code>key</code>，如果 Chunk 可以独立于之前的数据块进行解码，则为关键帧类型</li>
<li><code>delta</code> Chunk 必须在其他块被解码以后才能被解码</li>
</ul>
</li>
</ul>
<p>编码器产生的所有 Chunk 都是可以用解码器解码的。<br>之前提到的错误报告和方法的异步等事项，对解码器也是如此。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> responses = <span class="keyword">await</span> <span class="title function_">downloadVideoChunksFromServer</span>(timestamp);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; responses.<span class="property">length</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">const</span> chunk = <span class="keyword">new</span> <span class="title class_">EncodedVideoChunk</span>(&#123;</span><br><span class="line">    <span class="attr">timestamp</span>: responses[i].<span class="property">timestamp</span>,</span><br><span class="line">    <span class="attr">type</span>: responses[i].<span class="property">key</span> ? <span class="string">&quot;key&quot;</span> : <span class="string">&quot;delta&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(responses[i].<span class="property">body</span>),</span><br><span class="line">  &#125;);</span><br><span class="line">  decoder.<span class="title function_">decode</span>(chunk);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">await</span> decoder.<span class="title function_">flush</span>();</span><br></pre></td></tr></table></figure>

<p>现在，我们把解码好的帧展现在页面上。最好确保解码器的输出回调函数(<code>handleFrame()</code>)迅速返回。<br>在下面的例子中，它只是将一个帧添加到准备渲染的帧队列中。<br>渲染是独立进行的，由两个步骤组成：</p>
<ol>
<li>等待合适的时机来展示帧</li>
<li>在 Canvas 上绘制帧</li>
</ol>
<p>一旦帧不再被使用，就调用 <code>close()</code> 来在 GC 之前释放底层内存，这将减少平均内存使用量。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;canvas&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> pendingFrames = [];</span><br><span class="line"><span class="keyword">let</span> underflow = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">let</span> baseTime = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleFrame</span>(<span class="params">frame</span>) &#123;</span><br><span class="line">  pendingFrames.<span class="title function_">push</span>(frame);</span><br><span class="line">  <span class="keyword">if</span> (underflow) <span class="built_in">setTimeout</span>(renderFrame, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">calculateTimeUntilNextFrame</span>(<span class="params">timestamp</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (baseTime == <span class="number">0</span>) baseTime = performance.<span class="title function_">now</span>();</span><br><span class="line">  <span class="keyword">let</span> mediaTime = performance.<span class="title function_">now</span>() - baseTime;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="number">0</span>, timestamp / <span class="number">1000</span> - mediaTime);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">renderFrame</span>(<span class="params"></span>) &#123;</span><br><span class="line">  underflow = pendingFrames.<span class="property">length</span> == <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (underflow) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> frame = pendingFrames.<span class="title function_">shift</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Based on the frame&#x27;s timestamp calculate how much of real time waiting</span></span><br><span class="line">  <span class="comment">// is needed before showing the next frame.</span></span><br><span class="line">  <span class="keyword">const</span> timeUntilNextFrame = <span class="title function_">calculateTimeUntilNextFrame</span>(frame.<span class="property">timestamp</span>);</span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">r</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(r, timeUntilNextFrame);</span><br><span class="line">  &#125;);</span><br><span class="line">  ctx.<span class="title function_">drawImage</span>(frame, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  frame.<span class="title function_">close</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Immediately schedule rendering of the next frame</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(renderFrame, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Dev-Tips"><a href="#Dev-Tips" class="headerlink" title="Dev Tips"></a>Dev Tips</h2><p>在 Chrome DevTools 中使用 <a target="_blank" rel="noopener" href="https://developer.chrome.com/docs/devtools/media-panel/">Media Panel</a>，查看媒体日志和调试 WebCodecs。</p>
<figure>
  <img src="3.png", alt="用于调试WebCodecs的Media Panel的屏幕截图", width="800", height="375" />
</figure>

<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p>下面这个例子展示了 Canvas 上的动画是如何被：</p>
<ul>
<li>通过 <code>MediaStreamTrackProcessor</code> 以 25fps 的帧率采集到 <code>ReadableStream</code> 中</li>
<li>转发到 Worker 线程</li>
<li>编码成 H.264 的视频</li>
<li>再次解码为帧序列</li>
<li>使用 <code>transferControlToOffscreen()</code> 在另一个 Canvas 上渲染</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://glitch.com/~new-webcodecs-blogpost-demo">new-webcodecs-blogpost-demo</a></p>
<h3 id="Other-demos"><a href="#Other-demos" class="headerlink" title="Other demos"></a>Other demos</h3><p>Also check out our other demos:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://imagedecoder.glitch.me/">Decoding gifs with ImageDecoder</a></li>
<li><a target="_blank" rel="noopener" href="https://w3c.github.io/webcodecs/samples/capture-to-file/capture-to-file.html">Capture camera input to a file</a></li>
<li><a target="_blank" rel="noopener" href="https://w3c.github.io/webcodecs/samples/mp4-decode/">MP4 playback</a></li>
<li><a target="_blank" rel="noopener" href="https://w3c.github.io/webcodecs/samples/">Other samples</a></li>
</ul>
<h2 id="使用-WebCodecs-API"><a href="#使用-WebCodecs-API" class="headerlink" title="使用 WebCodecs API"></a>使用 WebCodecs API</h2><h2 id="兼容性检查"><a href="#兼容性检查" class="headerlink" title="兼容性检查"></a>兼容性检查</h2><p>检查对 WebCodecs 的支持:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="string">&quot;VideoEncoder&quot;</span> <span class="keyword">in</span> <span class="variable language_">window</span>) &#123;</span><br><span class="line">  <span class="comment">// WebCodecs API is supported.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>请注意，WebCodecs API 只在 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/Security/Secure_Contexts">secure contexts</a> 下运行，所以如果 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/docs/Web/API/WindowOrWorkerGlobalScope/isSecureContext"><code>self.isSecureContext</code></a> 是 false，则检测会失败。</p>
<h2 id="Feedback"><a href="#Feedback" class="headerlink" title="Feedback"></a>Feedback</h2><p>The Chrome team wants to hear about your experiences with the WebCodecs API.</p>
<h3 id="Tell-us-about-the-API-design"><a href="#Tell-us-about-the-API-design" class="headerlink" title="Tell us about the API design"></a>Tell us about the API design</h3><p>Is there something about the API that doesn’t work like you expected? Or are<br>there missing methods or properties that you need to implement your idea? Have a<br>question or comment on the security model? File a spec issue on the<br>corresponding <a target="_blank" rel="noopener" href="https://github.com/w3c/webcodecs/issues">GitHub repo</a>, or add<br>your thoughts to an existing issue.</p>
<h3 id="Report-a-problem-with-the-implementation"><a href="#Report-a-problem-with-the-implementation" class="headerlink" title="Report a problem with the implementation"></a>Report a problem with the implementation</h3><p>Did you find a bug with Chrome’s implementation? Or is the implementation<br>different from the spec? File a bug at <a target="_blank" rel="noopener" href="https://bugs.chromium.org/p/chromium/issues/entry?components=Blink%3EMedia%3EWebCodecs">new.crbug.com</a>.<br>Be sure to include as much detail as you can, simple instructions for<br>reproducing, and enter <code>Blink&gt;Media&gt;WebCodecs</code> in the <strong>Components</strong> box.<br><a target="_blank" rel="noopener" href="https://glitch.com/">Glitch</a> works great for sharing quick and easy repros.</p>
<h3 id="Show-support-for-the-API"><a href="#Show-support-for-the-API" class="headerlink" title="Show support for the API"></a>Show support for the API</h3><p>Are you planning to use the WebCodecs API? Your public support helps the<br>Chrome team to prioritize features and shows other browser vendors how critical<br>it is to support them.</p>
<p>Send emails to <a href="mailto:media-dev@chromium.org">media-dev@chromium.org</a> or send a tweet<br>to <a target="_blank" rel="noopener" href="https://twitter.com/ChromiumDev">@ChromiumDev</a> using the hashtag<br><a target="_blank" rel="noopener" href="https://twitter.com/search?q=%23WebCodecs&src=typed_query&f=live"><code>#WebCodecs</code></a><br>and let us know where and how you’re using it.</p>
<p><a target="_blank" rel="noopener" href="https://unsplash.com/photos/8eQOBtgn9Qo">Hero image</a> by<br><a target="_blank" rel="noopener" href="https://unsplash.com/@dmjdenise">Denise Jans</a><br>on <a target="_blank" rel="noopener" href="https://unsplash.com/">Unsplash</a>.</p>
</div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/Aloento.png" alt="Aloento"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Aloento</p><p class="is-size-6 is-block">Reindeer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Foot of Sacred Mountain</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">2</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">6</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">12</p></a></div></div></nav></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Diary/"><span class="level-start"><span class="level-item">Diary</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Program/"><span class="level-start"><span class="level-item">Program</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul><li><a class="level is-mobile" href="/categories/Program/C/"><span class="level-start"><span class="level-item">C++</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/Program/C/CLI/"><span class="level-start"><span class="level-item">CLI</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Program/FrontEnd/"><span class="level-start"><span class="level-item">FrontEnd</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/Program/FrontEnd/WebCodecs/"><span class="level-start"><span class="level-item">WebCodecs</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/NET/"><span class="tag">.NET</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C#</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C++</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CLI/"><span class="tag">CLI</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LINQ/"><span class="tag">LINQ</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OrderBy/"><span class="tag">OrderBy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/WebCodecs/"><span class="tag">WebCodecs</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%89%8D%E7%AB%AF/"><span class="tag">前端</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%97%A5%E8%AE%B0/"><span class="tag">日记</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BC%96%E7%A8%8B/"><span class="tag">编程</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BF%BB%E8%AF%91/"><span class="tag">翻译</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%9F%B3%E8%A7%86%E9%A2%91/"><span class="tag">音视频</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://Q-Audio.org" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Q-Audio</span></span><span class="level-right"><span class="level-item tag">q-audio.org</span></span></a></li><li><a class="level is-mobile" href="https://Musi.Land" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">MusiLand</span></span><span class="level-right"><span class="level-item tag">musi.land</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-04-05T03:58:53.000Z">2022-04-05</time></p><p class="title"><a href="/Program/FrontEnd/WebCodecs/%E8%AE%BA%E4%BD%BF%E7%94%A8WebCodecs%E5%AF%B9%E8%A7%86%E9%A2%91%E8%BF%9B%E8%A1%8C%E5%A4%84%E7%90%86/">论使用WebCodecs对视频进行处理</a></p><p class="categories"><a href="/categories/Program/">Program</a> / <a href="/categories/Program/FrontEnd/">FrontEnd</a> / <a href="/categories/Program/FrontEnd/WebCodecs/">WebCodecs</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-12-03T07:15:37.000Z">2021-12-03</time></p><p class="title"><a href="/Diary/%E8%AE%BA%E5%A6%82%E4%BD%95%E5%9C%A8CPPCLI%E4%B8%AD%E4%BD%BF%E7%94%A8LINQ%E4%B9%8B%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%A5%87%E5%A6%99%E7%9A%84CPP%E5%A4%A7%E4%BD%9C%E4%B8%9A/">论如何在C++/CLI中使用LINQ：记一次奇妙的C++大作业</a></p><p class="categories"><a href="/categories/Program/">Program</a> / <a href="/categories/Program/C/">C++</a> / <a href="/categories/Program/C/CLI/">CLI</a> / <a href="/categories/Diary/">Diary</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2022/04/"><span class="level-start"><span class="level-item">April 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/12/"><span class="level-start"><span class="level-item">December 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><p class="is-size-7"><span>&copy; 2022 Aloento</span><br><span id="busuanzi_container_site_uv">Visited by <span id="busuanzi_value_site_uv">0</span> users</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Q-Audio" href="https://Q-Audio.org"><i class="fas fa-compact-disc"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="MusiLand" href="https://Musi.Land/"><i class="fab fa-dashcube"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="GitHub" href="https://github.com/Aloento"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://unpkg.com/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://unpkg.com/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://unpkg.com/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><script src="https://unpkg.com/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://unpkg.com/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://unpkg.com/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>