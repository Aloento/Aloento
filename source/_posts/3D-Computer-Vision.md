---
title: 3D Computer Vision
toc: true
categories:
  - [AI, 3D]
tags: [3D视觉, 考试]
date: 2025-12-16 18:19:27
---

我不中了

<!-- more -->

## Basic Estimation Theory

估计 = 给定很多不完美的观测，用数学找“最合理”的未知参数。

| 项目     | 齐次                        | 非齐次                    |
| -------- | --------------------------- | ------------------------- |
| 方程     | Ax = 0                      | Ax = b                    |
| 目标     | 最小 ‖Ax‖                   | 最小 ‖Ax − b‖             |
| 约束     | ‖x‖ = 1                     | 无                        |
| 解法     | 最小特征值 / SVD            | 正规方程                  |
| 典型任务 | Homography, F, Plane normal | Line fitting, Calibration |

### Solution for homogeneous linear system of equations

齐次线性方程组的解

数学形式 $ A x = 0 $

想象你有很多“约束”，但**它们都指向同一个方向**。

比如：

- 多个点大致在一条直线上
- 每个点都说一句话：“直线法向量应该满足这个关系”

这些约束合起来就是：

> **“找到一个非零向量 x，让 Ax 尽量接近 0”**

**x = 0 永远是解，但没意义**
所以我们强制一个约束：

> **‖x‖ = 1（单位长度）**

---

解：x 是 A 的**最小奇异值（Singular value）对应的奇异向量**。

---

典型例子

平面拟合 / 直线拟合

很多 3D 点 ≈ 在一个平面上：$ax + by + cz + d = 0$

→ 对每个点是一条齐次线性方程
→ 堆起来就是 (Ax = 0)
→ 用 **最小特征值（Eigenvalue）解**

### Solution for inhomogeneous linear system of equations

非齐次线性方程组的解

现在不是“全指向 0”，而是：

> 每个观测点说：“结果应该是 b，但我有噪声”

- 你问 100 个人体重
- 每个人都给你一个“差不多”的数
- 不可能完全一致

---

核心思想：**最小二乘**

> 找一个 x，使 **误差平方和最小**

$\min_x |Ax - b|^2$

---

解满足 **正规方程（Normal Equation）**：

$A^T A x = A^T b$

→ 解为：

$x = (A^T A)^{-1} A^T b$

---

几何解释

> Ax 是所有可能结果的一个子空间  
> b 被“投影”到这个子空间上  
> 投影点就是最优解

## Robust Fitting Methods

最小二乘一遇到离群点（outliers）就会崩。

- 你要用很多点拟合一条直线
- 80% 的点在直线附近
- 20% 是错误匹配（完全乱飞）

**普通最小二乘**会被这 20% “拉歪”
**RANSAC 的思想**：

> **与其相信所有点，不如只相信“彼此一致”的点**

RANSAC 的核心思想

> **随机抽最少点 → 建模型 → 看谁支持它 → 重复 → 选支持最多的模型**

### The RANSAC method

Step 1：随机采样（Random Sampling）

- 随机选 **最小样本数** 的点
- 这个数量 = **模型所需的最小点数**

例子：

- 直线：2 点
- Homography：4 点
- Fundamental matrix：7 或 8 点

这一步的假设是：

> “**这一次，抽到的点全是 inliers**”

---

Step 2：模型估计（Model Estimation）

- 用这几个点
- 直接算一个模型（通常是**线性解**）

例子：

- 2 点 → 一条直线
- 4 对点 → 一个 Homography

---

Step 3：一致性检测（Consensus / Inlier Test）

- 用这个模型
- **测试所有数据点**
- 计算误差（distance / reprojection error）

判断规则（口语版）：

> “误差 < 阈值 → inlier
> 误差 ≥ 阈值 → outlier”

---

Step 4：记录支持度（Support）

- 统计：

  > **有多少 inliers 支持这个模型**

- 支持度 = inlier 数量

---

Step 5：重复 + 选择最优

- 重复以上步骤 N 次
- 选择 **inlier 数最多** 的模型

最后一步（很多人漏说，但你要说）：

> **用所有 inliers 再做一次最小二乘精估**

这是为什么 RANSAC 的结果不“粗糙”。

---

RANSAC 是“在参数空间里做投票”

- 每一次随机采样 → 提出一个假设
- 每个数据点 → 给“支持 / 不支持”投票
- 得票最多的模型 → 胜出

---

最小样本数

- 由模型决定
- 决定了 RANSAC 的“基本成本”

阈值（Threshold）

- 决定 inlier / outlier
- 太小 → 好点被误删
- 太大 → 坏点混进来

要跑多少次才够？

> “希望至少有一次，抽到的点全部是 inliers”

---

优点

- 对 outliers **极其鲁棒**
- 简单、通用
- 和任何模型都能搭配

缺点

- 随机 → **结果不完全确定**
- 参数（阈值、次数）需要经验
- 只能找到 **一个模型**

但真实数据里可能有多个模型

## Multi-model Fitting

“RANSAC 只能找一个模型，那如果有多个模型怎么办？”

真实世界里，数据往往不只来自一个模型。

典型例子

- 激光雷达点云：**地面 + 墙 + 桌面**
- 图像直线检测：**多条直线**
- 特征匹配：**多个平面**

**普通 RANSAC：**

- 只能找到 **inliers 最多的那一个模型**
- 其他结构会被当成 outliers 丢掉

| Sequential RANSAC | MultiRANSAC |
| ----------------- | ----------- |
| 找一个，删一个    | 多个一起找  |
| 贪心              | 全局视角    |
| 简单              | 更复杂      |
| 易错              | 更稳健      |

### Sequential RANSAC

一次只找一个模型，找到后把它删掉，再找下一个

---

Step 1：在全部数据上跑 RANSAC

- 得到 **模型 M₁**
- 得到它的 **inliers 集合 I₁**

---

Step 2：移除 inliers

- 从数据集中删除 I₁
- 剩下的点 ≈ 其他模型 + 噪声

---

Step 3：在剩余数据上再跑 RANSAC

- 得到 **模型 M₂**
- 得到 **inliers I₂**

---

Step 4：重复

- 直到：

  - 剩余点太少
  - 或者 RANSAC 再也找不到“足够支持”的模型

---

形象比喻

> 像剥洋葱  
> 一层一层剥  
> 每一层都是一个模型

典型应用

- 多条直线检测
- 多个平面（尤其是 LiDAR / depth 数据）

---

优点

- 非常简单
- 基于标准 RANSAC
- 容易实现、调试

---

致命缺点

> **贪心（greedy）算法**

具体问题：

- 第一个模型如果估计得不好
- 错误的 inliers 被删掉
  → 后面的模型**永远找不到**

### MultiRANSAC

同时寻找多个模型，而不是一个一个删。

> RANSAC 不再只维护一个“最佳模型”，  
> 而是维护 **多个候选模型**，  
> 数据点可以在模型之间“竞争归属”。

1. **大量随机采样**
2. 生成许多模型假设
3. 每个点计算：

   - 它对每个模型的误差

4. 点被分配给：

   - 误差最小的模型

5. 对每个模型：

   - 用自己的 inliers 重新估计

6. 迭代直到稳定

本质类似：clustering + RANSAC

---

优点

- 不容易被早期错误带偏
- 能处理 **模型重叠**
- 适合复杂场景

缺点

- 算法复杂
- 参数多
- 计算量大
- 实现难度高

---

什么时候用 Sequential RANSAC？  
当模型之间分离得比较清楚

什么时候用 MultiRANSAC？  
模型数量未知  
或多个模型规模接近  
或模型有重叠

## Camera Models

相机模型描述的是：3D 点如何变成 2D 像素。

核心变量只有三个：

- **投影方式**
- **是否考虑深度变化**
- **自由度多少**

### Perspective camera

透视 / 针孔相机

> **离相机近的物体看起来大，远的看起来小。**

几何直觉

- 所有光线经过一个点（焦点）
- 3D 点 → 沿射线投影到成像平面

---

$u \sim K ,[R \mid t], X$

含义：

- (X)：世界坐标里的 3D 点
- (R,t)：相机姿态
- (K)：内参（焦距、主点等）

齐次坐标，只有比例意义

核心特性

- **有尺度歧义（scale ambiguity）**
- 深度 (Z) 决定成像大小：
  $u \propto \frac{1}{Z}$

---

优点

- 最真实
- 精确描述真实相机
- 所有 3D 几何理论的基础

缺点

- 参数多（内参 + 外参）
- 非线性
- 数学处理复杂

什么时候用？

> **近距离 / 大景深变化 / 精确 3D 重建**

### Orthogonal projection

正交投影

所有点“垂直”投影到图像平面，不考虑深度。

> 像工程制图
> 或影子在正午阳光下

---

数学直觉

$u = R_{1:2} X + t$

- 只保留 X、Y
- Z **完全被忽略**

核心特性

- **没有透视效应**
- 远近大小完全一样
- 模型最简单

---

自由度

- **5 DoF**

  - 3（旋转）
  - 2（平移）

---

什么时候用？

> **物体非常远、深度变化极小**

例如：

- 卫星影像
- 极远距离拍摄

### Weak-perspective camera

弱透视相机

> **真实透视太复杂，正交又太粗糙。**

折中方案：**Weak-Perspective**

---

核心假设

> **物体深度变化 ≪ 相机到物体的平均距离**

换句话说：

- 所有点的 Z **几乎一样**

---

投影思想

1. 先 **正交投影**
2. 再整体 **缩放**

---

数学直觉

$u = s \cdot R_{1:2}(X - t)$

- (s)：统一尺度因子
- 不再随每个点的 Z 变化

---

| 特性     | 透视 | 弱透视    | 正交 |
| -------- | ---- | --------- | ---- |
| 透视缩放 | ✔    | ✔（统一） | ✘    |
| 深度变化 | ✔    | ✘         | ✘    |
| 非线性   | ✔    | ✘         | ✘    |
| DoF      | 多   | **6**     | 5    |

弱透视 = 缩放正交投影

---

优点

- 线性
- 无尺度歧义
- 易估计
- 闭式解多

缺点

- 近距离或深度变化大时不准

---

什么时候用？

> **人脸、人体、刚体** > **中远距离、相对平坦结构**

Tomasi–Kanade 因式分解就是用它

---

为什么 Tomasi–Kanade 不能用透视？

> 因为透视投影是非线性的，
> 而因式分解需要线性模型。

什么时候弱透视会失败？

> 当物体离相机很近，
> 或深度变化很大时。

## Calibration of Perspective Camera Using a Spatial Calibration Object

给我一些已知 3D 点及其在图像中的位置，我可以估计整个相机。

什么是 Spatial Calibration Object？

- 一个 **几何结构已知的 3D 物体**
- 上面有 **容易检测的特征点**

典型例子

- 标定立方体
- 标定板（3D 坐标已知）
- 标定框架

与棋盘的区别：

- **这是 3D 物体**
- 棋盘是 **平面（2D）**

### Estimation of projection matrix

投影矩阵 P 的估计

透视相机模型：

$u \sim P X$

其中：

- (X = [X, Y, Z, 1]^T)（3D 点）
- (u = [u, v, 1]^T)（像素）
- (P)：**3×4 投影矩阵**

---

P 里有什么？

$P = K , R , [I \mid -t]$

所以：

- **K**：相机内参
- **R, t**：相机外参

估计 P = 一步到位估计 **整个相机**

---

核心思想

> **投影矩阵估计是一个“齐次线性问题”**

---

从一个 3D–2D 点对能得到什么？

对一个点：

$u \sim PX$

展开后可以得到：

- **2 条独立线性方程**
- 未知量是 P 的 12 个元素（但有尺度歧义）

---

最少需要多少点？

- P 有 **11 个自由度**（12 个数 − scale）
- 每个点给 2 个方程

至少需要 6 个 3D–2D 点对

---

线性估计流程

Step 1：建立线性方程

- 对每个点写出 2 条方程
- 堆叠成：
  $A p = 0$

其中：

- (p)：P 的 12 个元素组成的向量

---

Step 2：解齐次线性系统

- 排除平凡解 (p=0)
- 加约束：(|p| = 1)

解法：

> **SVD，取最小奇异值对应的向量**

---

Step 3：得到投影矩阵 P

- 只在比例意义下成立
- 已经能把 3D 点投影到图像上

---

> **这是代数误差最小化，不是几何误差**

所以：

- 通常作为 **初值**
- 后面可用 **非线性优化（Bundle Adjustment）精化**

### Decomposition of projection matrix

投影矩阵的分解

为什么要分解？

> **P 本身不好解释，我想要真正的相机参数。**

也就是：

- 焦距是多少？
- 主点在哪？
- 相机姿态是什么？

---

P 的结构再强调一次

$P = K [R \mid t]$

其中：

- 左边 3×3 是 (KR)
- 最后一列与 (t) 有关

---

分解的目标

从已知的 P，求：

- **K（内参）**
- **R（旋转）**
- **t（平移）**

---

核心技术：RQ 分解

为什么不是 QR？

- QR：正交 × 上三角
- 我们需要：**上三角 × 正交**

所以用 **RQ decomposition**

---

分解步骤

Step 1：取 P 的左 3×3 子矩阵

$M = P_{3\times3} = K R$

---

Step 2：对 M 做 RQ 分解

$M = K R$

- K：上三角矩阵（内参）
- R：正交矩阵（旋转）

需要处理符号，使：

- 焦距为正
- det(R) = 1

---

Step 3：计算平移向量 t

利用：

$p_4 = -K R t$

解得：

$t = - R^T K^{-1} p_4$

---

得到的结果

- **K**：

  - 焦距
  - 主点
  - 像素比例

- **R, t**：

  - 相机在世界坐标中的姿态

---

为什么投影矩阵只能估计到比例？

> 因为使用的是齐次坐标，
> 缩放 P 不改变投影结果。

为什么需要很多点？

> 为了抵抗噪声，
> 实际是一个过定约束问题。

这和棋盘标定有什么区别？

> 空间标定物是 3D，
> 棋盘是平面（2D），
> 棋盘通过多视角间接恢复 3D 信息。

## Chessboard-based Calibration of Perspective Cameras

不用 3D 标定物，只用一块平面棋盘，通过多张不同姿态的图片来标定相机。
为什么棋盘能标定相机？

关键原因

- 棋盘是 **平面**
- 平面 ↔ 图像之间存在 **Homography**
- 多个不同姿态 ⇒ 多个 Homography
- 这些 Homography **共享同一个相机内参 K**
  Chessboard-based Calibration 的整体流程（口语标准版）

---

Step 1：拍摄多张棋盘图像

- 同一块棋盘
- **不同位置 + 不同倾斜角度**
- 至少 **3 张**，实际更多更稳

---

Step 2：检测棋盘角点

- 棋盘角点位置精确、结构规则
- 可做到 **亚像素精度**

---

Step 3：对每一张图像估计 Homography

- 棋盘在世界坐标中是一个平面
- 每张图像：
  $u \sim H X_{\text{plane}}$

---

Step 4：由多个 Homography 解相机内参 K

- 利用：

  - 旋转矩阵列向量正交
  - 单位长度约束

- 得到 K（焦距、主点等）

---

Step 5：**加入畸变模型并非线性优化**

- 同时优化：

  - K
  - 外参
  - 畸变参数

- 最小化 **重投影误差**

---

为什么要考虑畸变？

> **真实镜头不是理想针孔模型。**

理想情况：

- 直线 → 图像中仍是直线

现实情况：

- 直线 → 弯曲

这会**严重影响 3D 重建精度**

### Radial distortion

径向畸变

离图像中心越远，偏移越严重。

常见两种类型

Barrel distortion（桶形）

- 直线向外鼓
- **最常见**
- 广角镜头

Pincushion distortion（枕形）

- 直线向内凹
- 长焦镜头

---

数学模型

- 以主点为中心
- 位移大小是：

  - 距离 r 的函数

- 用多项式近似：

  - (k_1, k_2, k_3)

> “用 r²、r⁴、r⁶ 的多项式修正”

---

重要细节

- 通常假设：

  - 畸变中心 ≈ 主点

- 参数很小
- 在 **非线性优化阶段一起估计**

### Tangential distortion

产生原因

> **镜头与成像平面没有完全对齐。**

也就是：

- 透镜装歪了
- 光轴不完全垂直传感器

---

直观表现

- 点被“拉向一侧”
- 不再是纯粹的径向对称

---

数学特性

- 与：

  - x·y
  - x²、y²
    相关

- 参数通常是：

  - (p_1, p_2)

---

与径向畸变的关系

> **切向畸变不是径向畸变的替代，而是补充。**

- Radial：对称
- Tangential：非对称

---

两种畸变的对比

| 项目     | Radial   | Tangential |
| -------- | -------- | ---------- |
| 原因     | 镜头曲率 | 镜头未对齐 |
| 对称性   | 中心对称 | 非对称     |
| 常见程度 | 非常常见 | 较少       |
| 参数     | k₁,k₂,k₃ | p₁,p₂      |

---

为什么畸变参数要用非线性优化？

> **畸变模型是非线性的，线性方法解不了。**

所以流程是：

1. 先忽略畸变，线性估计 K
2. 再：

   - 加入畸变
   - 用 Levenberg–Marquardt
   - 最小化重投影误差

---

为什么要拍不同姿态？

> 否则约束不足，
> 内参解不唯一。

畸变在什么时候最明显？

> 图像边缘。

棋盘标定 = 多张平面 Homography → 解内参 → 加畸变 → 非线性精化

## Plane-plane Homography

平面—平面单应变换

如果所有点都在同一个平面上，那么两张图之间只需要一个 3×3 矩阵就能互相变换。

一般情况：

- 3D 点 → 两张图
- 需要 **深度 Z**
- 问题复杂

但如果：

> **所有点都在同一个平面上**

那么：

- 深度被“消掉”
- 投影关系变成 **2D ↔ 2D**

所以可以用 Homography

---

数学形式

$u' \sim H u$

- $u, u'$：两张图里的像素点（齐次坐标）
- $H$：3×3 非奇异矩阵
- “$(\sim)$”：比例意义

---

Homography 的自由度

- 9 个元素
- 1 个尺度不重要

8 个自由度

---

Homography 从哪来？

场景 1：平面物体 + 两个相机

- 相机 1：(P_1)
- 相机 2：(P_2)
- 物体在同一平面上

消去 3D 坐标得到：

> **图像 1 ↔ 图像 2 的 Homography**

---

场景 2：同一个相机，旋转但不平移

- 相机光心不变
- 只旋转

整个场景都满足 Homography

这是全景拼接的核心前提

---

几何性质

- 直线 → 直线
- 平行线 **不一定**保持平行
- 角度、长度 **不保持**

Homography 是 **投影变换**

### Panoramic images by homographies

用单应性生成全景图

---

全景图的核心假设

> **相机只旋转，不平移。**

为什么？

- 平移 → 不同深度点产生视差
- 视差 → 一个 Homography 对不上

---

全景拼接的几何原理

### 关键公式

$u' \sim K R_2 R_1^T K^{-1} u$

意思：

- 同一相机
- 不同朝向
- 只靠旋转矩阵关系

这就是 Homography

---

全景拼接的标准流程

Step 1：特征点检测

- SIFT / ORB / SURF

---

Step 2：特征匹配

- 最近邻匹配
- 有大量错误匹配

---

Step 3：RANSAC 估计 Homography

- 剔除错误匹配
- 得到稳定的 H

---

Step 4：图像 Warp

- 用 H 把一张图“扭”到另一张图坐标系

---

Step 5：图像融合

- 重叠区域：

  - 平均
  - 加权
  - 多带融合

---

为什么全景拼接要用 RANSAC？

> **因为特征匹配里一定有大量 outliers。**

什么时候 Homography 不适合？

重要反例

- 相机有明显平移
- 场景是 **强 3D**
- 近处物体明显

会出现：

- 重影
- 拉伸
- 错位

---

Homography 的两个经典应用

图像拼接（Panorama）

- 手机全景
- 建筑内部

平面校正（IPM）

- 路面矫正
- 俯视图
- 车道线检测

---

Homography 和 Fundamental Matrix 的区别？

> Homography 假设 **点在同一平面**
> Fundamental Matrix 适用于 **一般 3D 场景**

全景拼接失败的原因？

> 相机发生平移
> 或场景不是单一深度

---

一句话总结

> **Homography 是平面之间的投影关系，
> 在相机纯旋转时可用于整幅图像的对齐。**

## Estimation of Homography

单应矩阵的估计

> **给定两张图像中的点对应关系，估计 Homography 矩阵 H。**

---

已知：

- 点对应：
  $u_i \leftrightarrow u'_i$

假设：

- 所有点 **在同一个平面上**
- 或相机 **纯旋转**

目标：

$u'_i \sim H u_i$

---

Homography 的未知量

- H 是 **3×3 矩阵**
- 有 **8 个自由度**（尺度无关）

所以：

> **至少需要 4 对点**

（4 × 2 = 8 个独立约束）

---

从“一对点”能得到什么？

设：
$u = [x, y, 1]^T,\quad u' = [x', y', 1]^T$

由：
$u' \sim H u$

展开后可以得到：

- **2 条独立线性方程**
- 对 H 的元素是线性的

---

线性方程组的形式

对每个点对：

- 写成：
  $A_i h = 0$

其中：

- $h$：H 的 9 个元素组成的向量

所有点堆起来：

$A h = 0$

这是一个齐次线性系统

---

如何解这个齐次系统？

- 平凡解 $h=0$ 没意义
- 加约束：
  $|h| = 1$

转化为：

> **最小化 (|Ah|)，同时 (|h|=1)**

---

解法

> **对矩阵 A 做 SVD，取最小奇异值对应的向量。**

原因：

- 这是 **代数误差最小化**
- 数值稳定
- 和前面学的 estimation theory 完全一致

---

你已经用 SVD 解了，为什么还不行？

> **数值不稳定。**

原因：

- 像素坐标数值大（几百上千）
- A 中不同列的量级差很多
- SVD 对尺度非常敏感

### Data Normalization

> **在解 Homography 之前，先把点坐标“变得好看”。**

---

对 **每一张图像的点集，分别做归一化**：

Step 1：平移（Translation）

- 把点集的 **质心** 移到原点

---

Step 2：缩放（Scaling）

- 缩放，使：

  - 点到原点的 **平均距离 = √2**

---

Step 3：得到归一化变换矩阵 T

$u' = T u$

---

用归一化点来估计 Homography

- 用归一化后的点：
  $\tilde{u}' \sim \tilde{H} \tilde{u}$
- 解：
  $\tilde{A} \tilde{h} = 0$

得到的是 **归一化坐标系下的 Homography**

---

反归一化

最终结果不是 $\tilde{H}$，而是：

$H = T_2^{-1} \tilde{H} T_1$

其中：

- $T_1$：第一张图的归一化矩阵
- $T_2$：第二张图的归一化矩阵

---

> **没有归一化的 8-point / 4-point 方法在实践中几乎不可用。**

- Hartley 证明过：

  - Normalization 是“**必须的，不是可选的**”

---

优点

- 快
- 有闭式解
- 适合作为初值

缺点

- 只最小化 **代数误差**
- 不是真正的几何距离
- 对 outliers 极度敏感

所以：

- **RANSAC + 非线性优化** 通常一起用

---

为什么平均距离是 √2？

> 为了让坐标尺度在 1 的量级，
> 提高数值稳定性。

归一化对结果有影响吗？

> 不改变几何关系，
> 但显著提升数值精度。

如果点很多怎么办？

> 问题变成过定约束，
> SVD 自动给出最小二乘意义下的解。

---

> **Homography 估计 = 线性齐次系统 + SVD + 数据归一化 + 反归一化**

## Basics of Epipolar Geometry

极几何基础

> **极几何描述的是：一个 3D 点在两张图像中的对应关系。**

---

为什么需要 Epipolar Geometry？

- 两张图像
- 一个 3D 点 X
- 在两张图里各有一个像素位置

问题：

> **第二张图里，对应点到底在哪？**

---

Epipolar Geometry 的核心直觉

三个关键元素

1. **Baseline**

   - 连接两个相机光心的直线

2. **Epipolar plane（极平面）**

   - 由：

     - 3D 点 X
     - 两个相机光心
       共同确定的平面

3. **Epipolar lines（极线）**

   - 极平面与图像平面的交线

---

> **一个点在第一张图像中确定后，
> 它在第二张图像中一定落在一条极线上。**

搜索问题：

- 从 **2D 区域搜索**
- 降到 **1D 直线搜索**

---

Epipolar Constraint（极约束）

> **对应点必须满足极约束，否则不可能来自同一个 3D 点。**

$u_2^T F u_1 = 0$

### Essential matrix

本质矩阵

---

Essential Matrix 什么时候用？

> **当相机是“已标定”的。**

也就是说：

- 内参 (K_1, K_2) 已知
- 像素点已转换成 **归一化相机坐标**

---

Essential Matrix 的定义

$u_2^T E u_1 = 0$

其中：
$E = [t]_\times R$

含义：

- $R$：相机之间的旋转
- $t$：相机之间的平移方向（**只有方向，没有尺度**）

---

Essential Matrix 的关键性质

1. **5 个自由度**

   - 3（旋转）
   - 2（平移方向，尺度未知）

2. **秩为 2**

3. **两个非零奇异值相等**

4. **可以通过 SVD 分解得到 R 和 t**

   - 有 **4 种解**
   - 只有一个是物理正确的

---

Essential Matrix 在做什么？

> **它把“几何关系”编码成一个矩阵。**

- 不关心像素单位
- 只关心空间结构

### Fundamental matrix

基础矩阵

---

Fundamental Matrix 什么时候用？

> **当相机“未标定”时。**

也就是：

- 焦距未知
- 主点未知
- 像素坐标是原始的

---

Fundamental Matrix 的定义

$u_2^T F u_1 = 0$

和 E 形式一样，但：

$F = K_2^{-T} E K_1^{-1}$

F = E + 相机内参的影响

---

Fundamental Matrix 的性质

1. **7 个自由度**
2. **秩为 2**
3. **定义在像素坐标系**
4. **完全描述两幅图之间的极几何**

---

E vs F 的核心区别（一定要会对比）

| 项目         | Essential (E)  | Fundamental (F) |
| ------------ | -------------- | --------------- |
| 是否需要标定 | ✔              | ✘               |
| 坐标         | 归一化相机坐标 | 像素坐标        |
| 自由度       | 5              | 7               |
| 是否可分解   | ✔（R,t）       | ✘（直接）       |

> **E 是“纯几何”，F 是“几何 + 相机内参”。**

---

### Rectification

立体校正

---

为什么要 Rectification？

> **为了让立体匹配更简单。**

原始情况：

- 极线是任意方向
- 搜索对应点很麻烦

---

Rectification 的目标（必说）

> **把两张图像变换，使对应点落在同一行。**

也就是说：

- 极线 → 水平线
- epipoles → 无穷远

---

Rectification 在几何上做了什么？

- 对两张图像分别应用 **Homography**
- Homography 是由 **极几何（F 或 E）** 决定的

不需要知道 3D 结构
只需要知道 F

---

Rectification 的好处

- 2D 搜索 → 1D 搜索
- 立体匹配更快
- 深度计算更稳定

Rectification 的代价

> **图像会被扭曲。**

特别是：

- Wide-baseline stereo
- 大视角差

所以：

- 有时 **不做 rectification**
- 而是直接沿极线搜索

---

Rectification 是否必须？

> 不必须，但通常有利于匹配。

Rectification 和 Homography 有什么关系？

> Rectification 本质上是
> 用 Homography 把极线对齐。

如果相机已标定，用 E 还是 F？

> 用 E 更好，但 F 也可以。

---

> 极几何把点匹配从 2D 搜索变成 1D 搜索，
> E 和 F 分别描述标定和未标定情况下的这种约束。

## Estimation of Essential and Fundamental Matrices

本质矩阵 E 与基础矩阵 F 的估计

> **从两张图像的点对应关系中，估计描述它们极几何关系的矩阵。**

---

已知：

- 点对应：
  $u_{1i} \leftrightarrow u_{2i}$

目标：

- 未标定相机 → **Fundamental matrix F**
- 已标定相机 → **Essential matrix E**

共同约束（极约束）：

$u_2^T F u_1 = 0 \quad \text{或} \quad u_2^T E u_1 = 0$

---

从“一对点”能得到什么？

对每一对对应点：

- 可以写出 **1 条线性方程**
- 对矩阵元素是线性的

把 N 对点堆起来：

$A f = 0 \quad \text{或} \quad A e = 0$

这是一个齐次线性系统

---

最少需要多少点？

Fundamental matrix F

- 自由度：**7**
- 实践中：

> **8-point method（≥8 点）**

---

Essential matrix E

- 自由度：**5**
- 理论最少：5 点
- 实践中常用：

> **8 点法 + 约束**

---

线性估计的标准步骤

Step 1：建立线性系统

- 对每对点写：
  $u_2^T F u_1 = 0$
- 得到：
  $A f = 0$

---

Step 2：SVD 解齐次系统

- 排除平凡解
- 加约束：
  $|f| = 1$

解法：

> **SVD，取最小奇异值对应向量**

---

Step 3：强制秩约束

- 理论要求：

  - **rank(F) = 2**
  - **rank(E) = 2**

做法：

1. 对估计矩阵做 SVD
2. 把最小奇异值设为 0
3. 重构矩阵

---

直接用 8-point method 行不行？

> **数值不稳定，必须归一化。**

### Data normalization

为什么要 Data Normalization？

> **像素坐标量级太大，导致线性系统病态。**

影响：

- SVD 不稳定
- 结果对噪声极度敏感

---

归一化做了什么？（和 Homography 一样）

对 **两张图的点，分别独立归一化**：

Step 1：平移

- 点集质心 → 原点

Step 2：缩放

- 平均距离 → √2

Step 3：得到归一化矩阵

$\tilde{u} = T u$

---

完整流程

1. 原始点 → 归一化点
2. 用归一化点估计 $\tilde{F}$ 或 $\tilde{E}$
3. 强制秩约束
4. **反归一化**：
   $F = T_2^{-T} \tilde{F} T_1^{-1}$

对 E 也是同理

---

为什么归一化是“必须的”？

> **没有归一化的 8-point 方法在实践中几乎不可用。**

这是 Hartley 的经典结论。

### Decomposition of essential matrix

本质矩阵的分解

为什么要分解 E

> **E 只是约束，我真正想要的是相机的 R 和 t。**

---

Essential Matrix 的结构回顾

$E = [t]_\times R$

性质：

- rank = 2
- 两个非零奇异值相等

---

分解方法

Step 1：对 E 做 SVD

$E = U , \text{diag}(\sigma, \sigma, 0) , V^T$

---

Step 2：构造候选解

利用固定矩阵 (W) 和 (Z)，得到：

- **2 个旋转**
- **2 个平移方向**

总共 **4 种 (R, t) 组合**

---

为什么有 4 种解？

- 平移方向有正负
- 旋转有对称解

---

如何选正确解？

> **正深度约束（cheirality condition）**

也就是：

- 3D 点必须在 **两个相机前方**

只有 **1 种解满足**

---

分解后的结果意味着什么？

- 得到：

  - R（准确）
  - t（**只有方向，没有尺度**）

这是为什么：

- 单目 / 双目视觉 **无法恢复绝对尺度**

---

为什么 E 不能直接用最小二乘？

> 因为 E 有额外的结构约束，
> 必须强制秩和奇异值条件。

E 和 F 的估计流程有何不同？

> 流程几乎一样，
> 区别在于：
>
> - E 用归一化相机坐标
> - F 用像素坐标

为什么实际中常用 RANSAC？

> 因为点对应中一定有 outliers，
> 线性方法对 outliers 非常敏感。

---

> E/F 的估计 = 归一化 + 线性 SVD + 秩约束，
> E 还能进一步分解出相机的相对位姿。

## Triangulation

### Standard stereo vision

### General stereo vision

## Stereo Vision for Planar Motion

## Tomasi-Kanade Factorization

### Multi-view reconstruction by orthogonal camera model

### Multi-view reconstruction by weak-perspective camera model

## Reconstruction by Merging Stereo Reconstructions

### Registration of two point sets by a similarity transformation

## Numerical Optimization

## Numerical Multi-view Reconstruction

### Bundle adjustment

## Reconstruction by Special Devices

### Laser scanning

### Depth camera

### LiDAR
